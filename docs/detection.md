# Детекция, трекинг и OCR (Шаг 4)

Черновая реализация детектора, трекера и OCR остаётся модульной. На этом шаге
фиксируются интерфейсы и конфигурация, чтобы в следующих итерациях подключить
реальные модели (YOLOv8/YOLOv11), трекеры (ByteTrack/SORT) и движки OCR
(EasyOCR/PaddleOCR/CRNN).

## Поток обработки кадра
1. Детектор получает кадр, применяет ROI/маску (при `require_roi=true`) и
   возвращает bounding boxes с confidence.
2. Трекер сопоставляет детекции в последовательности кадров, присваивает
   `track_id` и направление движения.
3. OCR движок вырезает регионы номерных знаков, выполняет голосование по
   `vote_frames` и выдаёт текст с уверенностью.
4. Результат кадра описывается структурой `FrameRecognition` и передаётся на
   постобработку (шаг 5).

## Конфигурация
Параметры задаются через переменные окружения (см. `.env.example`) и прокидываются в
`RecognitionPipeline`.

### Детектор
- `DETECTOR_MODEL` — `yolov8` | `yolov11` (дефолт `yolov8`).
- `DETECTOR_DEVICE` — `cuda` | `cpu`.
- `DETECTOR_CONFIDENCE_THRESHOLD` — порог детекции (default `0.25`).
- `DETECTOR_IOU_THRESHOLD` — IoU для suppression (default `0.45`).
- `DETECTOR_MAX_DETECTIONS` — ограничение количества боксов.
- `DETECTOR_REQUIRE_ROI` — bool, блокировать обработку без ROI.

### Трекер
- `TRACKER_TYPE` — `bytetrack` | `sort` (default `bytetrack`).
- `TRACKER_MAX_AGE` — максимально допустимый пропуск кадров.
- `TRACKER_MIN_HITS` — минимальное число подтверждений детекции.
- `TRACKER_MATCH_IOU_THRESHOLD` — порог совпадения по IoU.

### OCR
- `OCR_ENGINE` — `easyocr` | `paddleocr` | `crnn` (default `easyocr`).
- `OCR_VOTE_FRAMES` — количество кадров для голосования символов.
- `OCR_MIN_CONFIDENCE` — минимальная уверенность для фиксации результата.
- `OCR_LANGUAGES` — список языков (через запятую), default `en,ru`.

## API
`GET /api/v1/pipeline/status` — возвращает текущую конфигурацию детектора,
трекера и OCR (набор параметров выше). Эндпоинт предназначен для диагностики и
UI-интеграции.

## Следующие шаги
- Подключение реальных весов YOLO и трекера, интеграция cropper и извлечения ROI.
- Реализация OCR inference с буферизацией кадров и голосованием.
- Передача результата в постобработку (шаг 5) с шаблонами стран и
  антидубликатами.
