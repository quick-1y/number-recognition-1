# Ingest и декодирование видеопотоков (шаг 3)

Документ уточняет реализацию шага 3 дорожной карты: приём, декодирование и мониторинг видеопотоков.

## Цели шага
- Поддержка входных источников: RTSP, ONVIF, видеофайлы.
- Автоматическое переподключение с настраиваемым интервалом.
- Настройка целевого FPS и приоритетов декодера (NVDEC → VAAPI → CPU).
- Отдача статуса ingest через API и подготовка к дальнейшим модулям (детекция/трекинг/OCR).

## Модель данных каналов
- Таблица `channels` хранит настройки источников (RTSP/файл), целевой FPS, политику переподключения, ROI и направление движения.
- Поля `decoder_priority` и `direction` позволяют маршрутизировать кадры в нужный декодер и учитывать направление движения при обработке.

## Управление ingest
- `app/pipeline/ingest_manager.py` — единая точка учёта каналов и их состояния (`configured`, `streaming`, `reconnecting`).
- API `/api/v1/ingest/channels` позволяет регистрировать конфигурацию канала и получать снимок состояния.
- Фактический запуск воркеров (RTSP/ONVIF/файлы) будет добавлен на шаге 4 вместе с детекцией и декодером.

## Настройки окружения
- `INGEST_DEFAULT_TARGET_FPS` — целевой FPS, используемый по умолчанию.
- `INGEST_RECONNECT_SECONDS` — интервал переподключения при ошибках.
- `INGEST_DECODER_PRIORITY` — список приоритетов декодера через запятую (например, `nvdec,vaapi,cpu`).

## Поток данных (инкремент)
1. Канал регистрируется в `IngestManager` через API или конфигурацию.
2. Менеджер фиксирует целевой FPS, приоритеты декодера и направления, предоставляет статус для мониторинга.
3. На следующем шаге на каждый канал будут навешаны воркеры для приёма и декодирования кадров с учётом настроек, после чего кадры отправятся в детектор и трекер.
